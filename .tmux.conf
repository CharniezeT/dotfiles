# Reminder:
# Run grunt to watch for changes, or manually run
#   tmux source-file ~/.tmux.conf
# after each change, or restart the server with
#   tmux kill-server

# Auto-start tmux when opening a terminal with:
#   chsh -s /usr/bin/tmux
# (Then enter the user's password)

#================================================================================
# Key bindings
#================================================================================

# Change prefix from Ctrl+B to Ctrl+A - easier to type
set -g prefix C-a
unbind C-b
bind C-a send-prefix

#----------------------------------------
# Global
#----------------------------------------

# Alt+arrow = Switch pane
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Alt+PageUp/Down = Switch window
bind -n M-PageUp previous-window
bind -n M-PageDown next-window

# Note: Key bindings involving Alt + other modifiers don't seem to work in PuTTY
# so I can't do Ctrl+Alt+arrow or Ctrl+Tab, for example

#----------------------------------------
# Prefixed - No modifier
#----------------------------------------

# Space = Next layout
# PageUp = Scroll up and start copy mode
# Arrow keys = Select pane above

# ! = Break pane out into it's own window
# " = Split window vertical
# # = List copy/paste buffers
# $ = Rename session
# % = Split window horizontal
# & = Kill window
# ' = Jump to window
# ( = Previous session
# ) = Next session
# , = Rename window
# - = Split window vertical
# . = Set window number
# : = Command prompt
# ; = Toggle between two panes
# = = Choose buffer and paste it
# ? = List current key bindings
# [ = Copy mode
# ] = Paste buffer
# { = Swap with previous pane
# } = Swap with next pane
# ~ = Show recent messages

# 0-9 = Jump to window number

# C = New window
# D = Disconnect client
# F = Find window by name

# H = Display cheatsheet
bind h run "cat ~/.tmux_cheatsheet"

# I = Display status message

# J = Join pain from another window
bind j command-prompt -p "Join pane from:" "join-pane -h -s '%%'"

# L = Toggle between two windows
# N = Next window
# O = Next pane
# P = Previous window
# Q = Display pane numbers
# R = Refresh client
# S = Choose session
# T = Display clock
# W = Choose window
# X = Kill pane

#----------------------------------------
# Prefixed - Shift
#----------------------------------------

# Shift+C = New session
bind C command-prompt -p "New session:" "new-session -s '%%'"

# Shift+D = Choose client to disconnect

# Shift+L = Toggle between two sessions

# Shift+X = Kill session
bind-key X confirm-before -p "Kill session #S (y/n)?" "run-shell 'tmux switch-client -n \\\; kill-session -t \"\$(tmux display-message -p \"#S\")\"'"

# Shift+R = Reload config
bind R source-file ~/.tmux.conf \; display-message 'Reloaded ~/.tmux.conf'

#----------------------------------------
# Prefixed - Ctrl
#----------------------------------------

# Ctrl+Arrow keys = Resize pane (small increments) - doesn't seem to work

# Ctrl+A = Sent literal Ctrl+A
# Ctrl+O = Rotate window
# Ctrl+Z = Suspend client

#----------------------------------------
# Prefixed - Alt
#----------------------------------------

# Alt+Arrow keys = Resize pane

# Alt+1 = Layout: Even horizontal
# Alt+2 = Layout: Even vertical
# Alt+3 = Layout: Main horizontal
# Alt+4 = Layout: Main vertical
# Alt+5 = Layout: Tiled

# Alt+N = Next window with alert
# Alt+O = Rotate panes within the current window
# Alt+P = Previous window with alert

#================================================================================
# Settings
#================================================================================

# Disable Esc+Arrow - conflicts with Vim
set -g escape-time 0

# Use Vi style navigation keys in copy mode
setw -g mode-keys vi
bind-key -t vi-copy v begin-selection
bind-key -t vi-copy y copy-selection

# Enable utf8 support
set -g mouse-utf8 on
set -g status-utf8 on
setw -g utf8 on

# Enable 256-color support
set -g default-terminal screen-256color

# Load bash instead of /bin/sh
set -g default-shell /bin/bash

# Start numbers at 1 not 0 - easier to jump to with keyboard
set -g base-index 1
set -g pane-base-index 1

# Simplify the status bar
set -g status-left '#[fg=magenta]#S:'
set -g status-right '#[fg=cyan]#H'
setw -g window-status-format ' [#I. #W]'
setw -g window-status-current-format ' [#I. #W]'

# Change status bar colours
setw -g status-bg black
setw -g status-fg white
setw -g window-status-current-fg green

# Highlight windows with activity
setw -g monitor-activity on
setw -g window-status-activity-fg yellow
setw -g window-status-activity-attr none # Not reversed

# Enable various mouse operations
set -g mouse-resize-pane on
set -g mouse-select-pane on
set -g mouse-select-window on
setw -g mode-mouse on

# Set terminal title to the current pane title
set -g set-titles on
set -g set-titles-string '#T'
