# Reminder:
# Run grunt to watch for changes, or press Ctrl-A, Shift-R after each change,
# or restart the server with
#   tmux kill-server

#================================================================================
# Key bindings
#================================================================================

# Change prefix from Ctrl+B to Ctrl+A - easier to type
set -g prefix C-a
unbind C-b
bind C-a send-prefix

#----------------------------------------
# Global
#----------------------------------------

# Alt+Arrow keys = Switch pane
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Alt+PageUp/Down = Switch window
bind -n M-PageUp previous-window
bind -n M-PageDown next-window

# Ctrl+Alt+Left/Right = Switch window (not in PuTTY)
bind -n C-M-Left previous-window
bind -n C-M-Right next-window

# Ctrl+Alt+Up/Down = Switch session (not in PuTTY)
bind -n C-M-Up switch-client -p
bind -n C-M-Down switch-client -n

#----------------------------------------
# Prefixed - No modifier
#----------------------------------------

# Space = Next layout
# PageUp = Scroll up and start copy mode
# Arrow keys = Select pane

# # = List copy/paste buffers
# ' = Jump to window
# , = Rename window
# . = Set window number
# ; = Toggle between two panes
# = = Choose buffer and paste it
# [ = Copy mode
# ] = Paste buffer

# / = Display cheatsheet (? without shift)
# Run through sed because tmux seems to ignore blank lines
bind / run "cat ~/.tmux_cheatsheet | sed 's/^$/ /'"

# < = Move window left
bind -r < swap-window -t -1

# > = Move window right
bind -r > swap-window -t +1

# 0-9 = Jump to window number

# B = Break pane out to its own window
bind b break-pane

# C = New window
# D = Disconnect client
# F = Find window by name

# H = Split window horizontal
# (Note: Vim and tmux differ in their use of the words horizontal and vertical,
# and I agree with Vim, so these may appear to be swapped around)
bind h split-window -v

# I = Display status message

# J = Join pane to another window (same session)
bind j command-prompt -p "Join pane to window:" "join-pane -t ':%%'"

# L = Toggle between two windows
# N = Next window
# O = Next pane
# P = Previous window
# Q = Display pane numbers
# R = Refresh client
# S = Choose session
# T = Display clock

# V = Split window vertical
bind v split-window -h

# W = Choose window
# X = Kill pane

# Z = Zoom (toggle) (requires tmux 1.8+)
bind z resize-pane -Z

#----------------------------------------
# Prefixed - Shift
#----------------------------------5------

# Shift+Arrow keys = Resize pane (small increments) - doesn't seem to work - doesn't seem to work in PuTTY
bind-key -r    S-Up resize-pane -U
bind-key -r  S-Down resize-pane -D
bind-key -r  S-Left resize-pane -L
bind-key -r S-Right resize-pane -R

# Shift-: = Command prompt
# Shift-? = List current key bindings
# Shift-{ = Swap with previous pane
# Shift-} = Swap with next pane
# Shift-~ = Show recent messages

# Shift-1 (!) = Break pane out into it's own window
# Shift-2 (") = Split window vertical
# Shift-4 ($) = Rename session
# Shift-5 (%) = Split window horizontal
# Shift-7 (&) = Kill window
# Shift-9 (() = Previous session
# Shift-0 ()) = Next session

# Shift+C = New session
bind C command-prompt -p "New session:" "new-session -s '%%'"

# Shift+D = Choose client to disconnect

# Shift+J = Join pane to another window (different session)
bind J command-prompt -p "Join pane to (session:window):" "join-pane -t '%%'"

# Shift+L = Toggle between two sessions

# Shift+X = Kill session
bind X confirm-before -p "Kill session #S (y/n)?" "run-shell 'tmux switch-client -n \\\; kill-session -t \"\$(tmux display-message -p \"#S\")\"'"

# Shift+R = Reload config
bind R source-file ~/.tmux.conf \; display-message 'Reloaded ~/.tmux.conf'

#----------------------------------------
# Prefixed - Ctrl
#----------------------------------------

# Ctrl+Arrow keys = Resize pane (small increments) - doesn't seem to work in PuTTY

# Ctrl+A = Send literal Ctrl+A

# Ctrl+D = Disconnect client (same as D but easier to type)
bind C-d detach-client

# Ctrl+O = Rotate window
# Ctrl+Z = Suspend client

#----------------------------------------
# Prefixed - Alt
#----------------------------------------

# Alt+Arrow keys = Resize pane (larger increments)

# Alt+/ = Manual
bind M-/ new-window 'man tmux'

# Alt+1 = Layout: Even vertical
# Alt+2 = Layout: Even horizontal
# Alt+3 = Layout: Main vertical
# Alt+4 = Layout: Main horizontal
# Alt+5 = Layout: Tiled

# Alt+D = Disconnect all other clients
bind M-d detach -a

# Alt+N = Next window with alert
# Alt+O = Rotate panes within the current window
# Alt+P = Previous window with alert

#================================================================================
# Settings
#================================================================================

# Disable Esc+Arrow - conflicts with Vim
set -g escape-time 0

# Use Vi style navigation keys in copy mode
setw -g mode-keys vi
bind-key -t vi-copy v begin-selection
bind-key -t vi-copy y copy-selection

# Enable utf8 support
set -g mouse-utf8 on
set -g status-utf8 on
setw -g utf8 on

# Enable 256-color support
set -g default-terminal screen-256color

# Load bash instead of /bin/sh
set -g default-shell /bin/bash

# Start numbers at 1 not 0 - easier to jump to with keyboard
set -g base-index 1
set -g pane-base-index 1

# Simplify the status bar
set -g status-left '#[fg=magenta]#S:'
set -g status-right '#[fg=cyan]#H'
setw -g window-status-format ' [#I. #W]'
setw -g window-status-current-format ' [#I. #W]'

# Change status bar colours
setw -g status-bg black
setw -g status-fg white
setw -g window-status-current-fg green

# Highlight windows with activity
setw -g monitor-activity on
setw -g window-status-activity-fg yellow
setw -g window-status-activity-attr none # Not reversed

# Enable various mouse operations
set -g mouse-resize-pane on
set -g mouse-select-pane on
set -g mouse-select-window on
setw -g mode-mouse on

# Set terminal title to the current pane title
set -g set-titles on
set -g set-titles-string '#T'

# Increase wait time for repeated commands
set -g repeat-time 750
